
orc_purge_spawn = {
	while = {
		count = $NUM$
		add_subunit = orc_infantry
		# random_list = {
		# 	120 = {
		# 		add_subunit = orc_infantry
		# 	}
		# 	50 = {
		# 		modifier = {
		# 			factor = 2
		# 			unit_location = {
		# 				has_building = barracks_building
		# 			}
		# 		}
		# 		add_subunit = orc_infantry
		# 	}
		# 	50 = {
		# 		modifier = {
		# 			factor = 0.5
		# 			unit_location = {
		# 				OR = {
		# 					terrain = mountain
		# 					terrain = marsh
		# 					terrain = jungle
		# 				}	
		# 			}
		# 		}
		# 		modifier = {
		# 			factor = 2
		# 			unit_location = {
		# 				has_building = barracks_building
		# 			}
		# 		}
		# 		add_subunit = orc_infantry
		# 	}
		# 	30 = {
		# 		modifier = {
		# 			factor = 0.1
		# 			unit_location = {
		# 				OR = {
		# 					terrain = mountain
		# 					terrain = marsh
		# 					terrain = jungle
		# 					terrain = forest
		# 				}	
		# 			}
		# 		}
		# 		modifier = {
		# 			factor = 2
		# 			unit_location = {
		# 				has_building = barracks_building
		# 			}
		# 		}
		# 		add_subunit = orc_infantry
		# 	}
		# 	20 = {
		# 		modifier = {
		# 			factor = 2
		# 			unit_location = {
		# 				terrain = farmland
		# 			}
		# 		}
		# 		add_subunit = orc_infantry
		# 	}
		# 	5 = {
		# 		modifier = {
		# 			factor = 2
		# 			unit_location = {
		# 				terrain = farmland
		# 			}
		# 		}
		# 		add_subunit = orc_infantry
		# 	}
		# 	5 = {
		# 		modifier = {
		# 			factor = 2
		# 			unit_location = {
		# 				has_building = barracks_building
		# 			}
		# 		}
		# 		add_subunit = orc_infantry
		# 	}
		# }
	}
}

orc_purge_effect = {
	if = {
		limit = {
			$LOC$ = { has_owner = yes }
		}
		if = {
			limit = { 
				$LOC$ = {
					has_variable = orc_master
					OR = {
						AND = {
							NOT = { var:orc_master = controller }
							var:orc_master = {
								war_with = PREV.controller
							}
						}
						AND = {
							NOT = { var:orc_master = owner }
							var:orc_master = {
								war_with = PREV.owner
							}
						}
					}
					any_neighbor_province = {
						exists = owner
						$LOC$.var:orc_master = controller
						has_siege = no
					}
				}
			}
			$LOC$ = {
				random_neighbor_province = {
					limit = {
						exists = owner
						$LOC$.var:orc_master = controller
						has_siege = no
					}
					save_scope_as = destination
				}
			}

			var:orc_master = {
				create_unit = {
					location = scope:destination
					save_scope_as = orcs
					sub_unit = orc_infantry
					name = "Displaced Orcs"
				}
			}
			scope:orcs = {
				set_variable = {
					name = displaced_orcs
				}
				random_sub_unit = {
					limit = { subunit_morale_percentage < 100 }
					add_subunit_morale = 1
				}
				$LOC$ = {
					every_pops_in_province = {
						limit = {
							pop_culture_group = orcs_group 
						}
						switch = {
							trigger = pop_type
							citizen = { scope:orcs = { orc_purge_spawn = { NUM = 4 } } }
							freemen = { scope:orcs = { orc_purge_spawn = { NUM = 4 } } }
							slaves = { scope:orcs = { orc_purge_spawn = { NUM = 3 } } }
							fallback = { scope:orcs = { orc_purge_spawn = { NUM = 3 } } }
						}
						kill_pop = yes
					}
				}
			}
		}
		else = {
			$LOC$ = { move_all_orcs_home_effect = yes }
		}
	}
}

#country scope
mark_orc_provinces = {
	if = {
		limit = { country_culture_group = orcs_group }
		every_owned_province = {
			set_variable = {
				name = orc_master
				value = PREV
			}
		}
	}
}

lotr_marry_family_heads = {
	every_family = {
		head_of_family = {
			if = {
				limit = {
					is_married = no
					NOT = { has_variable = being_married }
				}
				trigger_event = {
					id = marriage_system.1
				}
			}
		}
	}
}

lotr_culling = {
	if = {
		limit = {
			exists = mother
			exists = father
			father = {
				NOT = { can_breed_trigger = { TARGET = scope:newborn.mother } }
			}
		}
		death = {
			death_reason = death_congenital_defects
		}
	}
}

lotr_on_create_character_effect = {
	if = {
		limit = {
			OR = {
				has_culture = dunedain
				has_culture = rangers
				has_culture = black_numenorean
			}
			NOT = { has_trait = maia }
		}
		add_trait = strong_blood_of_numenor
	}
	else_if = {
		limit = {
			has_culture = lesser_dunedain
		}
		add_trait = blood_of_numenor
	}
	else_if = {
		limit = {
			OR = {
				has_culture_group = noldor_group
				has_culture_group = teleri_group
				has_culture_group = vanyar_group
			}
		}
		add_trait = elf
	}
	else_if = {
		limit = {
			has_culture_group = dwarf_group
		}
		add_trait = dwarf
	}
	else_if = {
		limit = {
			has_culture_group = orcs_group
		}
		add_trait = orc
	}
}

move_home_effect = {
	if = {
		limit = {
			any_country = {
				culture = $CULTURE$
			}
		}
		random_country = {
			limit = {
				culture = $CULTURE$
			}
			weight = {
				modifier = {
					factor = 5
					religion = $RELIGION$
				}
			}
			random_owned_province = {
				save_scope_as = target
			}
		}
		move_pop = scope:target
	}
	else_if = {
		limit = {
			any_country = {
				culture.culture_group = $CULTURE_GROUP$
			}
		}
		random_country = {
			limit = {
				culture.culture_group = $CULTURE_GROUP$
			}
			weight = {
				modifier = {
					factor = 5
					religion = $RELIGION$
				}
			}
			random_owned_province = {
				save_scope_as = target
			}
		}
		move_pop = scope:target
	}
}

#provice scope
move_all_orcs_home_effect = {
	every_pops_in_province = {
		limit = { pop_culture_group = orcs_group }
		move_home_effect = {
			CULTURE = culture
			CULTURE_GROUP = culture_group
			RELIGION = religion
		}
	}
}

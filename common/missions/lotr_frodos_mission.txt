lotr_frodos_mission = {
	header = "lotr_frodos_mission_header"
	icon = "lotr_frodos_mission_icon"

	repeatable = no

	chance = {}

	ai_chance = {
		factor = 0
	}

	potential = {
  	NOT = { has_variable = lotr_frodos_mission_activated_variable }
		has_civil_war = no
		is_ai = no
    OR = {
      this = c:SHI
      any_subject = {
        this = c:SHI
      }
      any_allied_country = {
        this = c:SHI
      }
    }
    # current_date > 3002.1.1 #year after bilbos birthday. It starts much layer in the non-movie timeline, though it is to be expected to take the player some time to take the mission
    religion = iluvatarism
	}

	on_potential = {
	}

	abort = {
		ai_mission_back_out_trigger = yes
	}

	on_start = {
    save_scope_as = frodo_protector_country
		start_mission_ai_effect = yes
    #create hobbits and Gandalf in the shire with olympic_competitor (rename the loc to fellowship. This should prevent many stuff that should not happen, like jobs, citizenship etc)
    c:SHI = {
      create_character = {
        first_name="Frodo"
        family_name="Baggins"
        age=34
        culture="harfoot"
        religion="iluvatarism"
        no_stats=yes
        add_martial=3
        add_charisma=12
        add_finesse=12
        add_zeal=12
        no_traits=yes
        force_add_trait="halfling"
        force_add_trait="olympic_competitor"
        save_scope_as = frodo
        dna="W9xb3JNYk1jK0srSAncCdwJ4AngE0ATQAV8BXwKNAo0CbQJtApACkAJnAmcDmgOaACIAIgJoAmgCawJrAnoCegKAAoACfwJ/AoACgAOvA68CcQJxAoQChAJrAmsBbQFtAn4CfgKGAoYChgKGAo4CjgKRApECegJ6AWABYAJ/An8CcwJzA6EDoQJsAmwCeAJ4ApQClAKWApYClAKUAn0CfQJuAm4EwATAAnoCegOhA6ECegJ6AmkCaQKIAogCjAKMBLoEugJmAmYEtgS2AmoCagJtAm0CggKCAnICcgKDAoMCdQJ1An8CfwGyAbIApgCmAPkA+QEUARQCpgKmAS0BLQFmAWYANgA2AAIAAgEvAS8BdAF0AEcARwB/AH8AQQBBAOoA6gCDAIMARgBGAO8A7wApACkD3QPdAUIBQgB/AH8BFQEVAHMAcwBYAFgBTgFOAtUC1QERAREATwBPAVYBVgAKAAoDFQMVAQoBCgCHAIcGmQaZAH8AfwNiA2IXKhcqAOYA5g2fDZ8VHRUdHpcelwAAAAAAAAAAAAAAAAIbAhs=" #alright
        add_to_list = fellowship
        add_to_list = frodoSam
      }
      create_character = {
        first_name="Samwise"
        family_name="Gamgee"
        age=22
        culture="harfoot"
        religion="iluvatarism"
        no_stats=yes
        add_martial=1
        add_charisma=8
        add_finesse=8
        add_zeal=16
        no_traits=yes
        force_add_trait="halfling"
        force_add_trait="olympic_competitor"
        save_scope_as = sam
        dna="lreWt49Sj1KYlpiWAoECgQJtAm0ChQKFApICkgKQApAClgKWAo8CjwJpAmkBXAFcAmwCbAJ1AnUCdQJ1Am0CbQJoAmgCmAKYBLUEtQJmAmYCmAKYApUClQKXApcCggKCAnMCcwKVApUCcAJwAn8CfwJxAnECfwJ/AWYBZgJtAm0CiQKJAmYCZgJpAmkCcwJzAoQChAFhAWECfAJ8AoYChgJrAmsCaQJpAoQChAKZApkCdgJ2AnoCegJ/An8BVwFXApcClwKPAo8CiwKLAooCigKEAoQCfwJ/AoACgAKHAocDsgOyAnoCegG7AbsATQBNACkAKQAMAAwAsACwArgCuAFjAWMAdAB0ArACsAFIAUgDSgNKAC4ALgB/AH8A5wDnAUwBTAAvAC8CkwKTAIQAhAKXApcAvgC+AJUAlQB/AH8AWABYAuYC5gEeAR4AuAC4AU4BTgKGAoYArgCuAMwAzABeAF4BagFqAPIA8gFhAWEB4wHjAH8AfwQOBA4X4RfhAHQAdA1ADUAVgxWDHuke6QAAAAAAAAAAAAAAAAKTApM=" #good one by chance
        add_to_list = fellowship
        add_to_list = frodoSam
      }
      create_character = {
        first_name="Meriadoc 'Merry'"
        family_name="Brandybuck"
        age=20
        culture="harfoot"
        religion="iluvatarism"
        no_stats=yes
        add_martial=5
        add_charisma=12
        add_finesse=8
        add_zeal=4
        no_traits=yes
        force_add_trait="halfling"
        force_add_trait="olympic_competitor"
        save_scope_as = merry
        add_to_list = fellowship
        add_to_list = fellowshipOtherHobbits
      }
      create_character = {
        first_name="Peregrin 'Pippin'"
        family_name="Took"
        age=16
        culture="harfoot"
        religion="iluvatarism"
        no_stats=yes
        add_martial=5
        add_charisma=12
        add_finesse=0
        add_zeal=4
        no_traits=yes
        force_add_trait="halfling"
        force_add_trait="olympic_competitor"
        save_scope_as = pippin
        dna="qISohKNUo1SBhoGGApcClwJmAmYAHgAeAnQCdAJtAm0ChgKGAmwCbAJrAmsAGwAbAokCiQKLAosChQKFAooCigOkA6QCjgKOApQClAOiA6ICZgJmApcClwKVApUCcQJxAnECcQJqAmoCdAJ0AngCeAJvAm8CbwJvApYClgKGAoYCcgJyAmgCaAFVAVUChgKGAmsCawJtAm0CfAJ8Am4CbgJvAm8CgwKDAoUChQKSApICcAJwAmcCZwKIAogCjAKMAo8CjwJxAnEBVQFVACYAJgJyAnICewJ7AogCiAJyAnICZgJmAVABUAHwAfABKwErAG4AbgCgAKAAUQBRAL8AvwKbApsBUgFSAREBEQCqAKoExgTGANgA2AB/AH8AJwAnAIQAhADYANgA0wDTAPMA8wC/AL8DkgOSAV8BXwB/AH8BAwEDAPgA+AAYABgAiwCLAT4BPgBcAFwAMwAzAAIAAgDBAMEAKAAoAQABAAEGAQYA5QDlAH8AfwQ6BDoX/xf/ACQAJA3jDeMVohWiHj4ePgAAAAAAAAAAAAAAAAKlAqU=" #not really
        add_to_list = fellowship
        add_to_list = fellowshipOtherHobbits
      }
      create_character = {
        first_name="Gandalf"
        family_name="the Grey"
        age=2800
        culture="maia"
        religion="iluvatarism"
        no_stats=yes
        add_martial=10
        add_charisma=25
        add_finesse=25
        add_zeal=25
        no_traits=yes
        force_add_trait="maia"
        force_add_trait="olympic_competitor"
        save_scope_as = gandalf
        dna="AAAH7oppimkAAAAAAp0CnQJ4AngCfwJ/AnYCdgKYApgCiwKLAlYCVgJ3AncCkwKTApcClwKXApcCiwKLAoECgQKLAosCTgJOAm0CbQKTApMCXgJeAmcCZwJWAlYCfwJ/AowCjAKaApoCdgJ2ApICkgKRApECkAKQAmwCbAKJAokCdQJ1ApUClQKeAp4CdAJ0ArACsAKUApQCcwJzAnYCdgKLAosCjAKMAn0CfQKTApMCjAKMAmECYQKMAowClQKVAo8CjwKLAosChgKGAnkCeQJRAlECbQJtAlkCWQKYApgCkwKTAsICwgQEBAQBZQFlATMBMwFhAWEATwBPAVABUAC2ALYALwAvAIcAhwCpAKkEnAScArYCtgFzAXMABwAHAN0A3QFpAWkAPwA/Aq8CrwCxALEDtwO3ARsBGwD5APkCngKeAQMBAwKVApUAOgA6AHwAfABIAEgAwwDDACYAJgD5APkCiAKIA3ADcAD0APQH6QDEAH8AfwQ3BDcWXhZeAPAA8Az+DP4QgxAXEf8R0AAAAAAAAAAAAAAAAAAAAAA="
      }
    }
	}

	on_abort = {
		# add_stability = -20
    set_variable = {
        name = lotr_frodos_mission_activated_variable
    }
	}

	on_completion = {
		complete_mission_effect = yes
	}
	
	
	
	lotr_frodo_start = {	
		icon = "task_conquest"
  	duration = 365
		
    highlight = {
    	scope:province = {
        OR = {
    		  is_in_area = formensiril_area
          is_in_area = baranduin_area
          is_in_area = breriondor_area
          is_in_area = oiomiril_area
          is_in_area = en_eredoriath_area
          is_in_area = rhudaur_area
          is_in_area = pinnath_tereg_area
          is_in_area = imladris_area
        }
    	}
    }

    potential = {
    }

    # bypass = {
    # }

		allow = {
		}

		on_start = {
      #gandalf moves to isengard, hobbits to CAR (or player if CAR does not exist). Notify eru countries
      every_country = {
        limit = {
          religion = iluvatarism
        }
        trigger_event = {
          id = lotr_frodos_mission_events.10
        }
      }

      #mordor declares war on you, nazghul army spawned between shire and bree. mordor gets "whips of sauron" army speed, morale and discipline bonuses
      c:MOR = {
        trigger_event = {
          id = lotr_frodos_mission_events.100
          days = { 5 10 } 
        }
      }

      #remaining orcs in the north declare war
      every_country = {
        limit = {
          OR = { #orcs/goblins in the north
            this = c:XKX
            this = c:XXY
            this = c:XXP
            this = c:XXQ
          }
        }
        trigger_event = {
          id = lotr_frodos_mission_events.110
          days = { 100 150 } 
        }
      }


		}

		on_completion = {
      trigger_event = {
        id = lotr_frodos_mission_events.11
      }
    }
  }

  lotr_reach_imladris = {  
    icon = "task_conquest"
    
    highlight = {
      scope:province = {
        OR = {
          is_in_area = formensiril_area
          is_in_area = baranduin_area
          is_in_area = breriondor_area
          is_in_area = oiomiril_area
          is_in_area = en_eredoriath_area
          is_in_area = rhudaur_area
          is_in_area = pinnath_tereg_area
          is_in_area = imladris_area
        }
        exists = owner
        controller = {
          country_culture_group = orcs_group
        }
      }
    }

    potential = {
    }

    requires = { lotr_frodo_start } 

    allow = {
      NOT = {
        any_province = {
          OR = {
            is_in_area = formensiril_area
            is_in_area = baranduin_area
            is_in_area = breriondor_area
            is_in_area = oiomiril_area
            is_in_area = en_eredoriath_area
            is_in_area = rhudaur_area
            is_in_area = pinnath_tereg_area
            is_in_area = imladris_area
          }
          exists = owner
          controller = {
            country_culture_group = orcs_group
          }
        }
      }
    }

    on_start = {
    }

    on_completion = {
      scope:gandalf = {
        add_to_list = fellowship
      }
      #move hobbits and gandalf to imladris,  TODO: possibly create copies of Aragorn, Legolas, Gimli, Boromir
      trigger_event = {
        id = lotr_frodos_mission_events.20
      }

      c:MOR = {
        trigger_event = {
          id = lotr_frodos_mission_events.101
        }
      }
    }
  }

  lotr_council_of_elrond = {  
    icon = "task_conquest"
    duration = 365
    
    highlight = {
      scope:province = {
        OR = {
          is_in_area = tal_bruinen_area
          is_in_area = pend_eregion_area
          is_in_area = emyn_sirannon_area

          is_in_area = khazad_dum_area
          is_in_area = lorien_area

          is_in_area = fordirith_area
          is_in_area = chail_caerdh_area
          AND = {
            is_in_area = calenhardin_area
            NOT = { this = p:1546 }
          }
          is_in_area = garth_annui_area


        }
      }
    }

    potential = {
    }

    requires = { lotr_reach_imladris } 

    # bypass = {
    # }

    allow = {
    }

    on_start = {
      #redeclare previous wars where needed
      #orcs will now declare war on all neighboring eru contries, possibly some specific like balins colony, gondor
      every_country = {
        limit = {
          orcs_that_hear_saurons_call = yes #includes sauron and northern orcs if needed
          NOT = { this = c:XVX }
        }
        trigger_event = {
          id = lotr_frodos_mission_events.110
          days = { 1 10 } 
        }
        trigger_event = {
          id = lotr_frodos_mission_events.112
          days = { 11 20 } 
        }
      }

      #saruman attacks rohan and the player (if he is evil). Whips of saruman buff
      #picture = event_council_of_elrond
    }

    on_completion = {
      #picture = etraval_ruin
    }
  }

  lotr_go_through_moria = {  
    icon = "task_conquest"
    
    highlight = {
      scope:province = {
        OR = {
          is_in_area = tal_bruinen_area
          is_in_area = pend_eregion_area
          is_in_area = emyn_sirannon_area

          is_in_area = khazad_dum_area
          is_in_area = lorien_area
        }
        exists = owner
        controller = {
          OR = {
            country_culture_group = orcs_group
            # AND = {
            #   exists = overlord
            #   overlord = {
            #     country_culture_group = orcs_group
            #   }
            # }
          }
        }
      }
    }

    potential = {
    }

    requires = { lotr_council_of_elrond } 

    prevented_by = { lotr_go_through_rohan }

    bypass = {
      has_completed_mission_task = lotr_depart_from_rohan 
    }

    # bypass = {
    # }

    allow = {
      NOT = {
        any_province = {
          OR = {
            is_in_area = tal_bruinen_area
            is_in_area = pend_eregion_area
            is_in_area = emyn_sirannon_area

            is_in_area = khazad_dum_area
            is_in_area = lorien_area
          }
          exists = owner
          controller = {
            OR = {
              country_culture_group = orcs_group
              # AND = {
              #   exists = overlord
              #   overlord = {
              #     country_culture_group = orcs_group
              #   }
              # }
            }
          }
        }
      }
    }

    on_start = {
    }

    on_completion = {
      #move fellowship to lorien
      #pciture = moria_entrance
    }
  }

  lotr_go_through_rohan = {  
    icon = "task_conquest"
    
    highlight = {
      scope:province = {
        OR = {
          is_in_area = tal_bruinen_area
          is_in_area = pend_eregion_area
          is_in_area = emyn_sirannon_area


          is_in_area = fordirith_area
          is_in_area = chail_caerdh_area
          AND = {
            is_in_area = calenhardin_area
            NOT = { this = p:1546 }
          }
          is_in_area = garth_annui_area
        }
        exists = owner
        controller = {
          OR = {
            country_culture_group = orcs_group
            # AND = {
            #   exists = overlord
            #   overlord = {
            #     country_culture_group = orcs_group
            #   }
            # }
          }
        }
      }
    }

    potential = {
    }

    requires = { lotr_council_of_elrond } 

    prevented_by = { lotr_go_through_moria }

    bypass = {
      has_completed_mission_task = lotr_depart_from_lorien 
    }

    # bypass = {
    # }

    allow = {
      NOT = {
        any_province = {
          OR = {
            is_in_area = tal_bruinen_area
            is_in_area = pend_eregion_area
            is_in_area = emyn_sirannon_area

            is_in_area = fordirith_area
            is_in_area = chail_caerdh_area
            AND = {
              is_in_area = calenhardin_area
              NOT = { this = p:1546 }
            }
            is_in_area = garth_annui_area
          }
          exists = owner
          controller = {
            OR = {
              country_culture_group = orcs_group
              # AND = {
              #   exists = overlord
              #   overlord = {
              #     country_culture_group = orcs_group
              #   }
              # }
            }
          }
        }
      }
    }

    on_start = {
    }

    on_completion = {
      #move fellowship to rohan
      #picture = event_orc_wargriders
    }
  }

  lotr_depart_from_lorien = {  
    icon = "task_conquest"

    # duration = 365
    
    highlight = {
      scope:province = {
        OR = {
          is_in_region = lorien_region
          is_in_region = rhuvenlhad_region
          is_in_region = calenardhon_region
          is_in_region = anorien_region
          is_in_region = ithilien_region
        }
      }
    }

    potential = {
    }

    requires = { lotr_go_through_moria } 

    prevented_by = { lotr_depart_from_rohan }

    bypass = {
      has_completed_mission_task = lotr_depart_from_rohan 
    }


    allow = {
    }

    on_start = {
      #redeclare previous wars where needed
      # all melkor countries now declare on the player (possibly exluding the extreme eastern ones)
      # 2 month later on neighboring eru countries

      #buffs for orcs are initially increased but will decay slightly with time

      #picture = light_of_earendil
    }

    on_completion = {
      #move sam and frodo to ithilien rangers, rest to gondor or rohan
      #kill boromir (might actually kill the real one unless player is gondor)
      #picture = city_siege
    }
  }

  lotr_depart_from_rohan = {  
    icon = "task_conquest"

    # duration = 365

    highlight = {
      scope:province = {
        OR = {
          # is_in_region = lorien_region
          is_in_region = rhuvenlhad_region
          is_in_region = calenardhon_region
          is_in_region = anorien_region
          is_in_region = ithilien_region
        }
      }
    }

    potential = {
    }

    requires = { lotr_go_through_rohan } 

    prevented_by = {  }

    bypass = {
      has_completed_mission_task = lotr_depart_from_lorien
    }


    allow = {
    }

    on_start = {
      #same as lorien
      #picture = event_rohan_riders
    }

    on_completion = {
      #move sam and frodo to ithilien rangers, rest to gondor or rohan
      #kill boromir (might actually kill the real one unless player is gondor)
      #picture = city_siege
    }
  }

  lotr_hold_back_sauron = {  
    icon = "task_conquest"
    
    highlight = {
      scope:province = {
        OR = {
          AND = {
            ROOT = {
              has_completed_mission_task = lotr_depart_from_lorien
            }
            is_in_region = lorien_region
          }
          is_in_region = rhuvenlhad_region
          is_in_region = calenardhon_region
          is_in_region = anorien_region
          is_in_region = ithilien_region
        }
        exists = owner
        controller = {
          OR = {
            country_culture_group = orcs_group
            # AND = {
            #   exists = overlord
            #   overlord = {
            #     country_culture_group = orcs_group
            #   }
            # }
          }
        }
      }
    }

    potential = {
    }

    requires = { 
      lotr_depart_from_lorien 
      lotr_depart_from_rohan
    } 

    allow = {
      NOT = {
        any_province = {
          OR = {
            AND = {
              ROOT = {
                has_completed_mission_task = lotr_depart_from_lorien
              }
              is_in_region = lorien_region
            }
            is_in_region = rhuvenlhad_region
            is_in_region = calenardhon_region
            is_in_region = anorien_region
            is_in_region = ithilien_region
          }
          exists = owner
          controller = {
            OR = {
              country_culture_group = orcs_group
              # AND = {
              #   exists = overlord
              #   overlord = {
              #     country_culture_group = orcs_group
              #   }
              # }
            }
          }
        }
      }
    }

    on_start = {
      #picture = hobbit_after_battle
    }

    on_completion = {
    }
  }

  lotr_distract_sauron = {  
    icon = "task_conquest"

    # duration = 365

    highlight = {
      scope:province = {
        OR = {
          is_in_region = rhuvenlhad_region
          is_in_region = calenardhon_region
          is_in_region = anorien_region
          is_in_region = ithilien_region
          this = p:1021
        }
      }
    }

    potential = {
    }

    requires = { 
      lotr_hold_back_sauron 
    } 

    allow = {
    }

    on_start = {
      # picture = throneroom
      #redeclare previous wars where needed
      # start event chain to check for black gate being under siege. Make sure this doesn't break if a battle happens on the black gate
      # buffs will be renewed once again, possibly army spawned.

      #frodo and sam to mordor. Make sure they are not converted to melkor
    }

    on_completion = {
      #picture = event_battle_black_gate
      #All that is left now, is to fight and hope for frodo
    }
  }

  lotr_frodo_destroys_ring = {  
    icon = "task_conquest"

    final = yes
    
    highlight = {
      scope:province = {
        OR = {
          is_in_region = rhuvenlhad_region
          is_in_region = calenardhon_region
          is_in_region = anorien_region
          is_in_region = ithilien_region
          this = p:1021
        }
        exists = owner
        controller = {
          OR = {
            country_culture_group = orcs_group
            # AND = {
            #   exists = overlord
            #   overlord = {
            #     country_culture_group = orcs_group
            #   }
            # }
          }
        }
      }
    }

    potential = {
    }

    requires = { 
      lotr_distract_sauron 
    } 

    allow = {
      has_variable = black_gate_sieged_long_enough
      NOT = {
        any_province = {
          OR = {
            is_in_region = rhuvenlhad_region
            is_in_region = calenardhon_region
            is_in_region = anorien_region
            is_in_region = ithilien_region
          }
          exists = owner
          controller = {
            OR = {
              country_culture_group = orcs_group
              # AND = {
              #   exists = overlord
              #   overlord = {
              #     country_culture_group = orcs_group
              #   }
              # }
            }
          }
        }
      }
      p:1021 = {
        OR = {
          NOT = {
            exists = owner
            controller = {
              country_culture_group = orcs_group
            }
          }
          has_siege = yes
        }
      }
    }

    on_start = {
    }

    on_completion = {
      # picture = event_one_ring_lava

      #kill sauron and nazghul
      #disable sauron events (converting countries, possibly others?)
      #option to end wars given to player (this would end them all, also AI vs AI)
        #choose between ending all wars or just the ones vs non-orc

      #massive maluses for all orc countries "sauron is defeated"
      # -80% morale
      # -40% discipline ?
      # 20 years +
      # revert orc growth bonuses (infighting)

      # slightly weaker malus for all melkor countries
      # 40% morale
      # -20% discipline
      # 20 years +
      # population unhappiness, possibly people converting (back) to ritualism (latter probably only while not at war anymore?)
      # malus removed by event to convert the country back to ritualism or ERU (latter exclusive culture groups that didn't have ritualism)



      #fellowship to player
      #send people home after a few month
    }
  }
	

############################# end #####################################
	
	
}